<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta name="generator" content="nico 0.5.2">
    <meta name="theme" content="one 0.2">
    <title>Excel 整合报表</title>
    <link rel="alternate" type="application/rss+xml" href="/feed.xml" title="Magic ABC" />
    <link rel="stylesheet" href="../static/one.css" />
  </head>
  <body>
    <div class="header">
      <div class="container">
        <div class="brand">
          <a class="home" href="../">Magic ABC</a>
        </div>
        <div class="menu" role="navigation">
          <a href="../../../../life/">生活</a>
          <a href="../../../../idea/">好主意</a>
          <a href="../../../../game-art/">独立游戏</a>
          <a href="../../../../gamemaker.html">点子工具</a>
          <a href="../../../../about.html">About</a>
        </div>
      </div>
    </div>
    <div class="document yue">
<div class="hentry" itemscope itemtype="http://schema.org/Article">
  <h1 class="entry-title" itemprop="name">Excel 整合报表</h1>
  <div class="entry-content" itemprop="articleBody"><p>我们常常需要从日志，数据库中取大量的数，这些记录常常是离散的，但业务需要将他们根据关键字合并，这项任务都有哪些做法呢？</p>
<ol>
<li>SQL join，不是一直都有这样的机会。</li>
<li>join，bash 的 join 命令。</li>
<li>写一段python 处理。</li>
<li>Excel处理。</li>
</ol>
<p>join操作或者join命令只能处理比较理想的情形，比如当join key缺失的时候，比如需要从多个key到不同列的尝试匹配。</p>
<p>在整合报表的时候，是一个反复尝试、预览的过程，这个时候命令行需要重复调整参数，并不比GUI更高效，不好调试，也容易遗漏。</p>
<p>Python是万能的，若每次遇到问题都从open,readline,split开始，不停的针对业务写脚本，并逐步抽取成一套工具集，为什么不直接 <strong>Find One</strong> 呢。</p>
<h2 id="excel很棒">Excel很棒</h2><p>Excel是非常棒的工具，除非要处理的是一个超大的表格。</p>
<p>Excel用于整合报表的函数主要是 <code>VLOOKUP</code> <code>LOOKUP</code>，且听我一一道来。</p>
<p>首先，我们的案例是sheet1 和 sheet2 通过 sheet3 连接，说人话大概是<strong>表1</strong>有关键字K1，数据KX，KY，<strong>表2</strong>有关键字K2，数据KX，KY，<strong>表3</strong>有K1、K2的关系。在这里通过K1,K2,KX,KY都不一定能在sheet1找到sheet2的对应。</p>
<p>以上是我之前处理的一个问题的简化，已经算复杂到不想用join了吧，每次写脚本呢又觉得很麻烦，其实看似问题清晰，但写程序的工作非常繁琐，涉及到搜索资料，调试排错，重构等等时间开销，一次性的开发，性价比并不高。</p>
<p>首先，在sheet1表通过<code>VLOOKUP</code>在sheet3查找K2：</p>
<pre>=VLOOKUP(K1, sheet3, index for K2)</pre><p>查找后，发现有些结果是<code>N/A</code>，这就需要在sheet1借助KX, KY，在sheet2查找K2：</p>
<pre>=VLOOKUP(KX, sheet2, index for K2)
=VLOOKUP(KY, sheet2, index for K2)</pre><p>sheet1新增的三列查找结果，都包含一些<code>N/A</code>，但所幸总算保证每条记录都找到K2。为了把sheet2的数据搬到sheet1的对应位置，现在要想办法把每条记录的<code>N/A</code>，空值，K2合并到一起。这里用到了<code>LOOKUP</code></p>
<h3 id="tricky">tricky</h3><pre>=LOOKUP(1, 1/(X1:Z1&lt;&gt;&quot;&quot;), X1:Z1)</pre><p>括号里的不等判断返回TRUE,FALSE，所以返回的就是1或者除0，自然能找到结果。</p>
<p>准确求出K2以后，将sheet2的数据取过来很简单，还是用<code>VLOOKUP</code>，只不过这次是横向填充，因此需要准备一个sheet4用于index递增。另外第一个参数的列位置要锁定，行值则不用。</p>
<pre>=VLOOKUP($L2,Sheet2!$A$2:$Q$412,Sheet6!A$1,FALSE)</pre></div>

  <div class="entry-meta">
    <time class="updated" datetime="2016-05-08T00:00:00.000Z" itemprop="dateModified">Sunday, May 8th, 2016</time>
  </div><div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'magicabc';
  var disqus_title = 'Excel 整合报表';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
</div>
</div>
    <div class="footer">
      <p class="copyright">powered by <a href="http://lab.lepture.com/nico/">nico</a> 0.5.2</p>
    </div>
    <div class="github"><a class="github-link" href="https://coding.net/u/hwh008">Fork me on GitHub</a></div>
    <script src="../static/one.js"></script>
  </body>
</html>